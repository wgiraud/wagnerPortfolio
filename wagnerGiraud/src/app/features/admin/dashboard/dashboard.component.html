<div class="dashboard-page">
  <header class="topbar">
    <p class="brand">Dashboard</p>

    <div class="actions">
      <a class="ghost-btn" routerLink="/welcome">Ver Welcome</a>
      <button type="button" class="ghost-btn" (click)="logout()">Sair</button>
    </div>
  </header>

  <main class="layout">
    <section class="editor">
      <h1>Editar conteudo do welcome</h1>
      <p class="hint">
        Edite cada projeto com titulo, descricao, link e imagem. Voce pode escolher imagem do
        dispositivo (ate 1.1 MB).
      </p>

      <form [formGroup]="form" (ngSubmit)="save()">
        <label for="heroTitle">Titulo</label>
        <input id="heroTitle" type="text" formControlName="heroTitle" />

        <label for="heroDescription">Descricao</label>
        <textarea id="heroDescription" rows="3" formControlName="heroDescription"></textarea>

        <div class="project-editor" formArrayName="projects">
          <div class="project-editor-head">
            <label>Projetos Reais</label>
            <button type="button" class="secondary small-btn" (click)="addProject()">
              Adicionar projeto
            </button>
          </div>

          @for (projectGroup of projectForms; track $index) {
            <article class="project-form-card" [formGroupName]="$index">
              <div class="project-form-header">
                <p>Projeto {{ $index + 1 }}</p>
                <button
                  type="button"
                  class="ghost-inline-btn"
                  (click)="removeProject($index)"
                  [disabled]="projectForms.length <= 1"
                >
                  Remover
                </button>
              </div>

              <label>Titulo</label>
              <input type="text" formControlName="name" placeholder="Nome do projeto" />

              <label>Descricao</label>
              <textarea
                rows="2"
                formControlName="description"
                placeholder="Resumo curto do projeto"
              ></textarea>

              <label>Link</label>
              <input type="url" formControlName="url" placeholder="https://projeto.com" />

              <label>Imagem</label>
              <input
                type="text"
                formControlName="imageUrl"
                placeholder="https://imagem.com/preview.png ou assets/projeto.png"
              />
              <div class="project-image-tools">
                <input
                  class="file-input"
                  type="file"
                  accept="image/*"
                  (change)="onProjectImageSelected($index, $event)"
                />
                <button
                  type="button"
                  class="ghost-inline-btn"
                  (click)="clearProjectImage($index)"
                  [disabled]="!projectGroup.controls.imageUrl.value"
                >
                  Limpar imagem
                </button>
              </div>

              @if (projectGroup.controls.imageUrl.value) {
                <figure class="project-image-preview">
                  <img
                    [src]="projectGroup.controls.imageUrl.value"
                    [alt]="'Preview da imagem do projeto ' + ($index + 1)"
                  />
                </figure>
              }
            </article>
          }
        </div>

        <label for="skills">Habilidades</label>
        <textarea id="skills" rows="5" formControlName="skills"></textarea>

        <label for="languages">Linguagens</label>
        <textarea id="languages" rows="5" formControlName="languages"></textarea>

        <div class="form-actions">
          <button type="submit">Salvar</button>
          <button type="button" class="secondary" (click)="restoreDefaults()">Restaurar padrao</button>
        </div>

        @if (statusMessage()) {
          <p class="feedback">{{ statusMessage() }}</p>
        }
      </form>
    </section>

    <section class="preview">
      <h2>Preview publicado</h2>
      <article class="preview-card">
        <h3>{{ content().heroTitle }}</h3>
        <p>{{ content().heroDescription }}</p>

        <h4>Projetos</h4>
        <ul>
          @for (project of content().projects; track project.name) {
            <li>
              <strong>{{ project.name }}</strong>
              @if (project.description) {
                <small class="project-desc">{{ project.description }}</small>
              }
              @if (project.imageUrl) {
                <small class="project-meta">Foto configurada</small>
              }
              @if (project.url) {
                <a [href]="project.url" target="_blank" rel="noopener noreferrer">Abrir projeto</a>
              }
            </li>
          }
        </ul>

        <h4>Habilidades</h4>
        <ul>
          @for (skill of content().skills; track skill) {
            <li>{{ skill }}</li>
          }
        </ul>

        <h4>Linguagens</h4>
        <ul>
          @for (language of content().languages; track language) {
            <li>{{ language }}</li>
          }
        </ul>
      </article>
    </section>
  </main>
</div>
